# 🧪 OpenClash 节点编辑功能测试指南

## 📋 测试环境准备

### 1. 启动应用
```bash
# 在项目根目录下运行
python app.py
```

### 2. 访问Web界面
打开浏览器访问: `http://localhost:8888`

## 🎯 测试用例

### 测试用例 1: 手动单个节点添加

#### 步骤 1: 测试手动添加界面
1. 在"编辑节点"选项卡中，选择"手动添加"选项
2. 验证界面显示两个列：左侧"节点基本信息"，右侧"协议设置"
3. 检查所有输入字段是否正确显示

#### 步骤 2: 测试SS节点添加
1. 在左侧填写节点基本信息：
   - 节点名称：`测试SS节点`
   - 服务器地址：`192.168.1.100`
   - 端口：`8388`
   - 密码：`password123`
2. 在右侧选择协议设置：
   - 协议类型：`Shadowsocks (SS)`
   - 加密方法：`aes-256-gcm`
   - 传输协议：`TCP`
3. 点击"测试节点"按钮，验证生成的链接
4. 点击"添加节点"按钮，验证节点是否成功添加

#### 步骤 3: 测试VMess节点添加
1. 清空表单（点击"清空表单"按钮）
2. 填写VMess节点信息：
   - 节点名称：`测试VMess节点`
   - 服务器地址：`192.168.1.200`
   - 端口：`8080`
   - UUID：`12345678-1234-1234-1234-123456789012`
3. 选择协议设置：
   - 协议类型：`VMess`
   - 传输协议：`WebSocket`
   - 路径：`/path`
   - 伪装域名：`example.com`
4. 点击"添加节点"按钮

#### 步骤 4: 测试从链接解析
1. 点击"从链接解析"按钮
2. 在弹出的对话框中输入：`ss://YWVzLTI1Ni1nY206cGFzc3dvcmQ=@192.168.1.100:8388#测试解析节点`
3. 验证表单是否正确填充解析出的信息

#### 预期结果
- ✅ 手动添加界面正常显示
- ✅ 协议字段根据协议类型动态显示/隐藏
- ✅ SS节点添加成功
- ✅ VMess节点添加成功
- ✅ 节点链接解析功能正常
- ✅ 表单验证功能正常

### 测试用例 2: 单个节点编辑

#### 步骤 1: 准备测试数据
1. 在节点管理区域添加以下测试节点：
```
ss://YWVzLTI1Ni1nY206cGFzc3dvcmQ=@192.168.1.100:8388#测试节点1
vmess://eyJhZGQiOiIxOTIuMTY4LjEuMTAwIiwicG9ydCI6IjgwODAiLCJpZCI6IjEyMzQ1Njc4OTAiLCJuZXQiOiJ3cyIsInR5cGUiOiJub25lIiwiaG9zdCI6IiIsInBhdGgiOiIiLCJ0bHMiOiIifQ==#测试节点2
```

#### 步骤 2: 测试单个节点编辑
1. 点击"保存节点"按钮
2. 切换到"节点列表"选项卡
3. 找到"测试节点1"，点击右侧的"编辑"按钮（铅笔图标）
4. 在弹出的编辑对话框中：
   - 修改节点名称为："编辑后的测试节点"
   - 修改服务器地址为："192.168.1.200"
   - 修改端口为："8443"
5. 点击"保存"按钮
6. 验证节点是否已更新

#### 预期结果
- ✅ 编辑对话框正常弹出
- ✅ 表单字段正确填充原始数据
- ✅ 修改后能正常保存
- ✅ 节点列表显示更新后的信息

### 测试用例 2: 批量节点编辑

#### 步骤 1: 选择多个节点
1. 在节点列表中勾选多个节点（至少2个）
2. 点击工具栏的"编辑"按钮

#### 步骤 2: 批量编辑
1. 在弹出的批量编辑对话框中：
   - 添加标签："测试,批量编辑"
   - 添加备注："这是批量编辑测试"
   - 添加前缀："[编辑]"
   - 添加后缀："(已修改)"
2. 点击"保存"按钮

#### 预期结果
- ✅ 批量编辑对话框正常弹出
- ✅ 显示正确的节点数量
- ✅ 批量修改成功应用
- ✅ 所有选中节点都显示更新后的信息

### 测试用例 3: 节点验证功能

#### 步骤 1: 测试有效节点
1. 在编辑对话框中输入有效的节点信息
2. 点击"测试"按钮

#### 步骤 2: 测试无效节点
1. 在编辑对话框中输入无效的节点信息
2. 尝试保存，观察错误提示

#### 预期结果
- ✅ 有效节点能正常保存
- ✅ 无效节点显示错误提示
- ✅ 错误信息清晰明确

### 测试用例 4: 界面交互测试

#### 步骤 1: 测试按钮状态
1. 未选择节点时点击"编辑"按钮
2. 选择单个节点时点击"编辑"按钮
3. 选择多个节点时点击"编辑"按钮

#### 步骤 2: 测试对话框交互
1. 点击"取消"按钮
2. 点击对话框外部区域
3. 按ESC键

#### 预期结果
- ✅ 未选择节点时显示提示信息
- ✅ 单个节点时显示编辑对话框
- ✅ 多个节点时显示批量编辑对话框
- ✅ 取消操作正常关闭对话框

### 测试用例 5: 键盘快捷键测试

#### 步骤 1: 测试快捷键
1. 选择节点后按 `Ctrl+E`（如果已实现）
2. 在编辑对话框中按 `Ctrl+S` 保存
3. 按 `Esc` 取消编辑

#### 预期结果
- ✅ 快捷键正常工作
- ✅ 操作响应及时

## 🔍 功能验证清单

### ✅ 手动单个节点添加
- [ ] 手动添加界面正常显示
- [ ] 左侧"节点基本信息"字段完整
- [ ] 右侧"协议设置"字段完整
- [ ] 协议类型切换时字段动态显示/隐藏
- [ ] 节点名称输入验证正常
- [ ] 服务器地址输入验证正常
- [ ] 端口号输入验证正常
- [ ] 密码字段验证正常（SS/Trojan）
- [ ] UUID字段验证正常（VMess/VLESS）
- [ ] 加密方法选择正常（SS）
- [ ] 传输协议选择正常
- [ ] 路径输入正常（WebSocket/HTTP）
- [ ] 伪装域名输入正常
- [ ] TLS设置切换正常
- [ ] SNI输入正常
- [ ] 标签输入正常
- [ ] 备注输入正常
- [ ] 原始链接显示正常
- [ ] "添加节点"按钮功能正常
- [ ] "测试节点"按钮功能正常
- [ ] "清空表单"按钮功能正常
- [ ] "从链接解析"按钮功能正常
- [ ] SS节点添加成功
- [ ] VMess节点添加成功
- [ ] VLESS节点添加成功
- [ ] Trojan节点添加成功
- [ ] 节点链接生成正确
- [ ] 表单验证提示正确

### ✅ 单个节点编辑
- [ ] 编辑对话框正常弹出
- [ ] 表单字段正确填充
- [ ] 节点名称可以修改
- [ ] 服务器地址可以修改
- [ ] 端口可以修改
- [ ] 密码可以修改
- [ ] 加密方法可以选择
- [ ] UUID可以修改（VMess/VLESS）
- [ ] 传输协议可以选择
- [ ] 路径可以修改
- [ ] 伪装域名可以修改
- [ ] TLS设置可以切换
- [ ] SNI可以修改
- [ ] 标签可以添加
- [ ] 备注可以添加
- [ ] 原始链接正确显示
- [ ] 保存功能正常工作
- [ ] 取消功能正常工作

### ✅ 批量节点编辑
- [ ] 批量编辑对话框正常弹出
- [ ] 显示正确的节点数量
- [ ] 标签批量添加功能
- [ ] 备注批量添加功能
- [ ] 前缀批量添加功能
- [ ] 后缀批量添加功能
- [ ] 批量保存功能正常
- [ ] 批量取消功能正常

### ✅ 界面交互
- [ ] 编辑按钮正常显示
- [ ] 按钮悬停效果正常
- [ ] 对话框样式美观
- [ ] 响应式设计正常
- [ ] 错误提示清晰
- [ ] 成功提示明确

### ✅ 后端API
- [ ] `/api/update_node` 接口正常
- [ ] `/api/batch_update_nodes` 接口正常
- [ ] `/api/validate_node` 接口正常
- [ ] 错误处理完善
- [ ] 日志记录正常

## 🐛 常见问题排查

### 问题 1: 编辑对话框不弹出
**可能原因**: JavaScript错误或Bootstrap未加载
**解决方法**: 
1. 检查浏览器控制台是否有错误
2. 确认Bootstrap JS文件已正确加载

### 问题 2: 保存失败
**可能原因**: 后端API错误或文件权限问题
**解决方法**:
1. 检查Flask应用日志
2. 确认文件写入权限
3. 验证节点格式是否正确

### 问题 3: 节点信息解析错误
**可能原因**: 节点格式不支持或解析逻辑有误
**解决方法**:
1. 检查节点链接格式
2. 确认解析函数逻辑
3. 添加更多协议支持

## 📊 测试报告模板

### 测试环境
- 操作系统: _________
- 浏览器: _________
- Python版本: _________
- Flask版本: _________

### 测试结果
- 单个节点编辑: ✅/❌
- 批量节点编辑: ✅/❌
- 节点验证功能: ✅/❌
- 界面交互: ✅/❌
- 后端API: ✅/❌

### 发现的问题
1. _________
2. _________
3. _________

### 建议改进
1. _________
2. _________
3. _________

## 🎉 测试完成

完成所有测试用例后，您就可以确认节点编辑功能已经正常工作！

如果遇到任何问题，请检查：
1. 浏览器控制台错误信息
2. Flask应用日志
3. 文件权限设置
4. 网络连接状态 